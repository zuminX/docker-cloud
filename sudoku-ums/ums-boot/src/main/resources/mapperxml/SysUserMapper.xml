<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zumin.sudoku.ums.mapper.SysUserMapper">
  <resultMap id="BaseResultMap" type="com.zumin.sudoku.ums.pojo.entity.SysUser">
    <!--@mbg.generated-->
    <!--@Table sys_user-->
    <id column="id" jdbcType="BIGINT" property="id"/>
    <result column="username" jdbcType="VARCHAR" property="username"/>
    <result column="password" jdbcType="VARCHAR" property="password"/>
    <result column="nickname" jdbcType="VARCHAR" property="nickname"/>
    <result column="avatar" jdbcType="VARCHAR" property="avatar"/>
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime"/>
    <result column="recent_login_time" jdbcType="TIMESTAMP" property="recentLoginTime"/>
    <result column="enabled" jdbcType="TINYINT" property="enabled"/>
  </resultMap>
  <sql id="Base_Column_List">
    <!--@mbg.generated-->
    id, username, `password`, nickname, avatar, create_time, recent_login_time, enabled
  </sql>

  <sql id="SelectUserWithRole">
    select u.*, r.id as role_id, r.name as role_name, r.nickname as role_nickname
    from sys_user u
           inner join sys_user_role ur on u.id = ur.user_id
           inner join sys_role r on ur.role_id = r.id
  </sql>

  <resultMap extends="BaseResultMap" id="UserWithRole" type="com.zumin.sudoku.ums.pojo.entity.SysUser">
    <collection ofType="com.zumin.sudoku.ums.pojo.entity.SysRole" property="roleList">
      <id column="role_id" property="id"/>
      <result column="role_name" property="name"/>
      <result column="role_nickname" property="nickname"/>
    </collection>
  </resultMap>

  <select id="selectWithRoleById" resultMap="UserWithRole">
    WITH user_merge_role as (
    <include refid="SelectUserWithRole"/>
    )
      select *
      from user_merge_role
      where id = #{userId,jdbcType=BIGINT}
  </select>
</mapper>